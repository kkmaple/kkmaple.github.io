[{"title":"Hierarchy Folder","url":"/2023/05/08/Hierarchy-Folder/","content":"\n思路\n新建一个Tag Folder 用于标识显示为Folder的Empty GameObject\n针对Tag为Folder的GameObject进行特殊绘制处理\n\n用到的UnityEditor方法\nhierarchyWindowItemOnGUI\nDisablePicking\n\nFull Codeusing UnityEngine;using UnityEditor;namespace kkmaple.EditorTool&#123;    [InitializeOnLoad]    public partial class CustomHierarchyFolder    &#123;        #region 静态构造        static CustomHierarchyFolder()        &#123;            EditorApplication.hierarchyWindowItemOnGUI += HierarchyWindowItemOnGUI;        &#125;        #endregion        #region 变量        public static GameObject selectObj;        #endregion        #region 菜单        [MenuItem(&quot;GameObject/Folder/Create Folder&quot;, false, -1)]        static void CreateEmptyFolder()        &#123;            GameObject obj = new GameObject();            Undo.RegisterCreatedObjectUndo(obj, obj.name);            if (Selection.activeTransform != null)            &#123;                Object[] selectedObjects = Selection.objects;                GameObject selectedGameObject = selectedObjects[0] as GameObject;                obj.transform.SetParent(selectedGameObject.transform);            &#125;            obj.name = &quot;New Folder&quot;;            EditorUtility.SetDirty(obj);            Selection.activeGameObject = obj;            AddTag(obj, &quot;Folder&quot;);        &#125;        [MenuItem(&quot;GameObject/Folder/Create Folder&quot;, true, -1)]        private static bool ValidateCreateEmpty()        &#123;            return Selection.objects.Length &lt;= 1;        &#125;        #endregion        #region 工具方法        /// &lt;summary&gt;        /// 向工程中添加tag        /// &lt;/summary&gt;        /// &lt;param name=&quot;tag&quot;&gt;tag名&lt;/param&gt;        public static void AddTagToProject(string tag)        &#123;            Object[] asset = AssetDatabase.LoadAllAssetsAtPath(&quot;ProjectSettings/TagManager.asset&quot;);            if ((asset != null) &amp;&amp; (asset.Length &gt; 0))            &#123;                SerializedObject so = new SerializedObject(asset[0]);                SerializedProperty tags = so.FindProperty(&quot;tags&quot;);                for (int i = 0; i &lt; tags.arraySize; ++i)                &#123;                    if (tags.GetArrayElementAtIndex(i).stringValue == tag)                    &#123;                        //tag已经存在啥也不做                        return;                    &#125;                &#125;                tags.InsertArrayElementAtIndex(0);                tags.GetArrayElementAtIndex(0).stringValue = tag;                so.ApplyModifiedProperties();                so.Update();            &#125;        &#125;        /// &lt;summary&gt;        /// 给指定对象添加tag        /// &lt;/summary&gt;        /// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;        /// &lt;param name=&quot;tag&quot;&gt;&lt;/param&gt;        public static void AddTag(GameObject obj, string tag)        &#123;            AddTagToProject(tag);            obj.tag = tag;        &#125;        /// &lt;summary&gt;        /// 重置GameObject位置        /// &lt;/summary&gt;        /// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;        internal static void TransfromReset(GameObject obj)        &#123;            obj.transform.localPosition = Vector3.zero;            obj.transform.localRotation = Quaternion.identity;            obj.transform.localScale = Vector3.one;        &#125;        /// &lt;summary&gt;        /// 勾选按钮        /// &lt;/summary&gt;        /// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;        /// &lt;param name=&quot;selectionRect&quot;&gt;&lt;/param&gt;        internal static void EnableDisableToggle(GameObject obj, Rect selectionRect)        &#123;            Rect r = selectionRect;            r.xMax = r.width;            r.x = selectionRect.xMax;            var tmpColor = GUI.color;            //设置透明            GUI.color = new Color(0, 0, 0, 0f);            if (GUI.Button(r, &quot;&quot;))            &#123;                obj.SetActive(!obj.activeInHierarchy);            &#125;            //还原颜色            GUI.color = tmpColor;            r.x = selectionRect.xMax;            GUI.Label(r, obj.activeInHierarchy ? EditorGUIUtility.IconContent(&quot;d_toggle_on_focus&quot;) : EditorGUIUtility.IconContent(&quot;d_toggle_bg&quot;));        &#125;        /// &lt;summary&gt;        /// 检查工程中是否存在tag        /// &lt;/summary&gt;        /// &lt;param name=&quot;tag&quot;&gt;tag名&lt;/param&gt;        public static bool IsTagExsist(string tag)        &#123;            Object[] asset = AssetDatabase.LoadAllAssetsAtPath(&quot;ProjectSettings/TagManager.asset&quot;);            if ((asset != null) &amp;&amp; (asset.Length &gt; 0))            &#123;                SerializedObject so = new SerializedObject(asset[0]);                SerializedProperty tags = so.FindProperty(&quot;tags&quot;);                bool exsist = false;                for (int i = 0; i &lt; tags.arraySize; ++i)                &#123;                    if (tags.GetArrayElementAtIndex(i).stringValue == tag)                    &#123;                        exsist = true;                        break;                    &#125;                    else                    &#123;                        exsist = false;                    &#125;                &#125;                if (exsist) return true;                else &#123; return false; &#125;            &#125;            else            &#123;                return false;            &#125;        &#125;        /// &lt;summary&gt;        /// 处理Folder显示        /// &lt;/summary&gt;        /// &lt;param name=&quot;instanceID&quot;&gt;Object id&lt;/param&gt;        /// &lt;param name=&quot;selectionRect&quot;&gt;&lt;/param&gt;        internal static void HierarchyWindowItemOnGUI(int instanceID, Rect selectionRect)        &#123;            GameObject obj = EditorUtility.InstanceIDToObject(instanceID) as GameObject;            if (obj == null)            &#123;                selectObj = null;                return;            &#125;            if (obj.transform == Selection.activeTransform)            &#123;                selectObj = obj;            &#125;            Rect r = selectionRect;            if (!IsTagExsist(&quot;Folder&quot;)) return;            //处理Folder显示            if (obj.CompareTag(&quot;Folder&quot;))            &#123;                EnableDisableToggle(obj, selectionRect);                //重置位置                TransfromReset(obj);                //隐藏编辑选项                obj.transform.hideFlags = HideFlags.NotEditable | HideFlags.HideInInspector;                obj.hideFlags = HideFlags.HideInInspector;                //在Hierarchy中不可pick                var sv = SceneVisibilityManager.instance;                sv.DisablePicking(obj, false);                GUI.color = new Color(1, 1, 1, 1);                r.xMin = selectionRect.x + 1;                r.xMax = r.xMin + 15f;                bool isPro = EditorGUIUtility.isProSkin;                if (obj.transform == Selection.activeTransform)                &#123;                    if (isPro) EditorGUI.DrawRect(r, new Color(0.17f, 0.36f, 0.52f, 1f));                    else &#123; EditorGUI.DrawRect(r, new Color(0.23f, 0.45f, 0.69f, 1f)); &#125;                &#125;                else                &#123;                    if (isPro) EditorGUI.DrawRect(r, new Color(0.22f, 0.22f, 0.22f, 1f));                    else &#123; EditorGUI.DrawRect(r, new Color(0.8f, 0.8f, 0.8f, 1f)); &#125;                &#125;                r = selectionRect;                r.x = selectionRect.xMin + 25;                if (obj.activeInHierarchy)                &#123;                    ChangeFolderIconActive(obj, selectionRect);                &#125;                else                &#123;                    ChangeFolderIconDactive(obj, selectionRect);                &#125;            &#125;        &#125;        /// &lt;summary&gt;        /// Folder Icon Active        /// &lt;/summary&gt;        static void ChangeFolderIconActive(GameObject obj, Rect selectionRect)        &#123;            int childcout = obj.transform.childCount;            bool isExtended = true;            string iconeName = string.Empty;            bool hasChild = childcout &gt; 0;            if (hasChild)            &#123;                if (EditorGUIUtility.isProSkin)                &#123;                    if (isExtended)                    &#123;                        iconeName = &quot;FolderOpened On Icon&quot;;                    &#125;                    else                    &#123;                        iconeName = &quot;Folder On Icon&quot;;                    &#125;                &#125;                else                &#123;                    if (isExtended)                    &#123;                        iconeName = &quot;FolderOpened Icon&quot;;                    &#125;                    else                    &#123;                        iconeName = &quot;Folder Icon&quot;;                    &#125;                &#125;            &#125;            else            &#123;                if (EditorGUIUtility.isProSkin)                &#123;                    iconeName = &quot;FolderEmpty On Icon&quot;;                &#125;                else                &#123;                    iconeName = &quot;FolderEmpty Icon&quot;;                &#125;            &#125;            EditorGUI.LabelField(selectionRect, EditorGUIUtility.IconContent(iconeName));        &#125;        /// &lt;summary&gt;        /// Folder Icon Dactive        /// &lt;/summary&gt;        static void ChangeFolderIconDactive(GameObject obj, Rect selectionRect)        &#123;            int childcout = obj.transform.childCount;            bool isExtended = true;            string iconeName = string.Empty;            bool hasChild = childcout &gt; 0;            if (hasChild)            &#123;                if (EditorGUIUtility.isProSkin)                &#123;                    if (isExtended)                    &#123;                        iconeName = &quot;FolderOpened Icon&quot;;                    &#125;                    else                    &#123;                        iconeName = &quot;Folder Icon&quot;;                    &#125;                &#125;                else                &#123;                    if (isExtended)                    &#123;                        iconeName = &quot;FolderOpened On Icon&quot;;                    &#125;                    else                    &#123;                        iconeName = &quot;Folder On Icon&quot;;                    &#125;                &#125;            &#125;            else            &#123;                if (EditorGUIUtility.isProSkin)                &#123;                    iconeName = &quot;FolderEmpty Icon&quot;;                &#125;                else                &#123;                    iconeName = &quot;FolderEmpty On Icon&quot;;                &#125;            &#125;            EditorGUI.LabelField(selectionRect, EditorGUIUtility.IconContent(iconeName));        &#125;    &#125;    #endregion&#125;","tags":["UnityEditor","Folder"]}]